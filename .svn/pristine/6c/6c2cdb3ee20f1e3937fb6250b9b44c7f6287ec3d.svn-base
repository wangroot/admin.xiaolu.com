<?php

use yii\helpers\Html;
use app\components\HodoActiveForm;
use app\modules\adsplatform\models\Datadict;
use app\modules\adsplatform\models\Position;
use yii\helpers\Url;
/* @var $this yii\web\View */
/* @var $model app\modules\adsplatform\models\Ad */
/* @var $form app\components\HodoActiveForm */
$this->registerJsFile('@web/js/jquery-form.js', ['position' => \yii\web\View::POS_END , 'depends' => 'app\assets\AppAsset']);
?>

<div class="game-form">

    <?php $form = HodoActiveForm::begin([
        'options' => [
            'class' => 'form-horizontal',
            'enctype' => "multipart/form-data",
        ],
    ]); ?>

    <div class="row">
        <div class="col-md-6">
            <?= $form->textInput($model, 'title') ?>
        </div>
    </div>
    <div class="row">
        <div class="col-md-6">
            <?= $form->textInput($model, 'subtitle') ?>
        </div>
    </div>
    <div class="row">
        <div class="col-md-6">
            <?=
            $form->select2($model, 'position_id',[
                'language' => Yii::$app->language,
                'data' => Position::getList() ,
                'options' => [],
                'pluginOptions' => [
                    'allowClear' => true,
                    'multiple' => false
                ],
            ]);
            ?>
        </div>
    </div>
    <div class="row">
        <div class="col-md-6">
            <?= $form->radioList($model, 'type', [], Datadict::getDataList('ad_type'))?>
        </div>
    </div>
    <div class="row">
        <div class="col-md-6">
            <?= $form->radioList($model, 'target', [], Datadict::getDataList('ad_target'), ['id' => 'ad_targets'])?>
        </div>
    </div>
    <div class="row">
        <div class="col-md-6">
            <?= $form->textInput($model, 'image',['labelOptions' => ['class' => 'control-label col-md-3']],['id' => 'image']) ?>
        </div>
        <div class="col-md-3">
            <div class="btn btn-primary"  id="btn_image">
                点我上传
            </div>
        </div>

    </div>
    <div class="row">
        <div class="col-md-6">
            <?= $form->textInput($model, 'image_vertical',['labelOptions' => ['class' => 'control-label col-md-3']],['id' => 'image_vertical']) ?>
        </div>
        <div class="col-md-3">
            <div class="btn btn-primary" id="btn_image_vertical">
                点我上传
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-6">
            <?= $form->textInput($model, 'link') ?>
        </div>
    </div>
    <div class="row">
        <div class="col-md-6">
            <?= $form->textInput($model, 'detail') ?>
        </div>
    </div>
    <div class="row">
        <div class="col-md-6">
            <?= $form->textInput($model, 'package_name') ?>
        </div>
    </div>
    <div class="row">
        <div class="col-md-6">
            <?= $form->textInput($model, 'version_code') ?>
        </div>
    </div>
    <div class="row">
        <div class="col-md-6">
            <?= $form->radioList($model, 'collect_data', [], Datadict::getDataList('ad_collect_data')) ?>
        </div>
    </div>
    <div class="row">
        <div class="col-md-6">
            <?= $form->textInput($model, 'show_time') ?>
        </div>
    </div>
    <div class="row">
        <div class="col-md-6">
            <?= $form->textInput($model, 'start_time', ['labelOptions' => ['class' => 'control-label col-md-3', 'placeholder'=>'2016-04-18 00:00:00']]) ?>
        </div>
    </div>
    <div class="row">
        <div class="col-md-6">
            <?= $form->textInput($model, 'end_time',  ['labelOptions' => ['class' => 'control-label col-md-3', 'placeholder'=>'2016-04-18 00:00:00']]) ?>
        </div>
    </div>
    <div class="row">
        <div class="col-md-6">
            <?= $form->textInput($model, 'ceiling_view') ?>
        </div>
    </div>
    <div class="row">
        <div class="col-md-6">
            <?= $form->textInput($model, 'ceiling_day_click') ?>
        </div>
    </div>
    <div class="row">
        <div class="col-md-6">
            <?= $form->textInput($model, 'ceiling_total_view') ?>
        </div>
    </div>
    <div class="row">
        <div class="col-md-6">
            <?= $form->textInput($model, 'ceiling_total_click') ?>
        </div>
    </div>
    <div class="row">
        <div class="col-md-6">
            <?= $form->radioList($model, 'status', [], Datadict::getDataList('ad_status')) ?>
        </div>
    </div>

    <?php
//        $form->fileInput($model, 'image',[], [
//        'options' => [
//            'accept' => 'image/*',
//            'multiple' => false
//        ],
//        'pluginOptions' => [
//            'uploadUrl' => Url::to(['upload-file/index']),
//            'uploadAsync' => true,
//            'minFileCount' => 1,
//            'maxFileCount' => 1,
//            'overwriteInitial' => false,
//            'uploadExtraData' => [
//                'm' => 'Game',
//                'name' => 'icon'
//            ],
//            'showUpload' => true,
//            'browseLabel' => '',
//           // 'initialPreview' => [],//$model->Select2Init('icon')['initialPreview'],
//            //'initialPreviewConfig'=> //$model->Select2Init('icon')['initialPreviewConfig'],
//        ],
//    ]) ?>
    <?php /* $form->fileInput($model, 'image_vertical',[], [
        'options' => [
            'accept' => 'image/*',
            'multiple' => false
        ],
        'pluginOptions' => [
            'uploadUrl' => Url::to(['upload-file/index']),
            'uploadAsync' => true,
            'minFileCount' => 1,
            'maxFileCount' => 1,
            'overwriteInitial' => false,
            'uploadExtraData' => [
                'm' => 'Game',
                'name' => 'icon'
            ],
            'showUpload' => true,
            'browseLabel' => '',
           // 'initialPreview' => [],//$model->Select2Init('icon')['initialPreview'],
            //'initialPreviewConfig'=> //$model->Select2Init('icon')['initialPreviewConfig'],
        ],
    ])*/ ?>

    <div class="row">
        <div class="col-md-2"></div>
        <div class="col-md-offset-3 col-md-6">
            <?= Html::submitButton($model->isNewRecord ? '完成' : '更新', ['class' => $model->isNewRecord ? 'btn btn-success' : 'btn btn-primary']) ?>
            <?= Html::a('取消', Url::toRoute('index') ,['class' => 'btn btn-default']) ?>
        </div>
    </div>

    <?php HodoActiveForm::end(); ?>

</div>
<div class="modal fade" id="picModal" tabindex="-1" role="dialog"
     aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close"
                        data-dismiss="modal" aria-hidden="true">
                    &times;
                </button>
                <h4 class="modal-title" id="myModalLabel">
                    上传图片
                </h4>
            </div>
            <div class="modal-body">
                <form  method="post" enctype="multipart/form-data" id= "uploadForm" action="http://ksadmin.youxilaile.com//cli_php/auto_load/get_picture_from_xiaoluad.php">
                    <input type="file" name="file" class="file" id="file"/>
                    <input type="text" name="token" hidden  value= "<?=md5('185c1053a5b7b580e30bffee9cce50c4')?>" >
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default"
                        data-dismiss="modal">关闭
                </button>
                    <button  class="btn btn-primary" data-dismiss="modal" id="upload">
                    上传
                </button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal -->
</div>
<?php
    $js = <<<js
    $(document).ready(function(){
        var type = '';
        $("#btn_image").click(function(){
            
           $('#picModal').modal('show');
           type ='image';
           return false;
        });
        
        $("#btn_image_vertical").click(function(){
            
            $('#picModal').modal('show');
            type ='image_vertical';
            return false;
        });
        
        $('#upload').click(function () {
        
               uploadPic();
        });
        
        function uploadPic() {
            
            console.log(type);
            $("#uploadForm").ajaxSubmit(

                function(data) {

                    if(type == 'image') {
                        console.log(data);
                        $('#image').val(data);
                    }else {
                        $('#image_vertical').val(data);
                    }
                }
            );
            return false;
        }
    });
        
js;
$this->registerJs($js, \yii\web\View::POS_END)
?>
<script>


//        //异步提交表单
//        $("#ajaxSubmitt").click(function(){
//            alert('sdf');
//            var action = $('#uploadForm').attr('action');
//            alert(action);
//            console.log($(this));
//            $("#uploadForm").ajaxSubmit({
//                type:'post',
//                url: action,
//                success:function(data){
//                    console.log(data);
//                },
//                error:function(XmlHttpRequest,textStatus,errorThrown){
//                    console.log(XmlHttpRequest);
//                    console.log(textStatus);
//                    console.log(errorThrown);
//                }
//            });
//        });
    //    document.getElementById("uploadForm").onsubmit = function(e) {
//
//        e.preventDefault();
//
//        var f = e.target,
//            formData = new FormData(f),
//            xhr = new XMLHttpRequest();
//
//        xhr.open("POST", f.action);
//        xhr.send(formData);
//    }

//    function uploadPic() {
//
//        var formobj =  document.getElementById("uploadForm");
//        var formData = new FormData(formobj);
//        $.ajax({
//            url: 'http://localhost/admin.kuaiyouxi.com/cli_php/auto_load/get_picture_from_xiaoluad.php',
//            type: 'post',
//            data: formData,
//            async: false,
//            dataType:'jsonp',
//            jsonp:'callback',
//            cache: false,
//            contentType: false,
//            processData: false,
//            success: function (result) {
//                alert('success');
//                alert(result.message); //回调输出
//
//                result = result || {};
//                if (result.msg=='err'){
//                    alert(result.info);
//                }else if (result.msg=="ok"){
//                    alert('提交成功');
//                }else{
//                    alert('提交失败');
//                }
//            },
//            error: function (returndata) {
////                alert(returndata);
//            }
//        });
//    }

</script>
